# éƒ¨ç½²æ–¹æ¡ˆè¯¦è§£

## ğŸš€ éƒ¨ç½²æ–¹æ¡ˆæ¦‚è§ˆ

æœ¬é¡¹ç›®æ”¯æŒå¤šç§éƒ¨ç½²æ–¹æ¡ˆï¼Œé€‚åˆä¸åŒçš„ä½¿ç”¨åœºæ™¯å’ŒæŠ€æœ¯éœ€æ±‚ã€‚

## ğŸ“Š éƒ¨ç½²æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | éš¾åº¦ | æˆæœ¬ | æ€§èƒ½ | é€‚ç”¨åœºæ™¯ |
|------|------|------|------|----------|
| Vercel | â­ | å…è´¹ | â­â­â­â­â­ | ä¸ªäººé¡¹ç›®ã€å°å‹ä¼ä¸š |
| Netlify | â­ | å…è´¹ | â­â­â­â­ | é™æ€ç½‘ç«™ã€å¿«é€ŸåŸå‹ |
| é™æ€å¯¼å‡º | â­â­ | ä½ | â­â­â­â­ | ä¼ ç»ŸæœåŠ¡å™¨ã€CDN |
| Docker | â­â­â­ | ä¸­ | â­â­â­â­â­ | å®¹å™¨åŒ–ç¯å¢ƒ |
| äº‘æœåŠ¡å™¨ | â­â­â­â­ | ä¸­é«˜ | â­â­â­â­â­ | ä¼ä¸šçº§åº”ç”¨ |

## 1. ğŸŒŸ Vercel éƒ¨ç½²ï¼ˆæ¨èï¼‰

### ç‰¹ç‚¹
- **é›¶é…ç½®**: æ— éœ€å¤æ‚è®¾ç½®
- **å…¨çƒCDN**: è®¿é—®é€Ÿåº¦å¿«
- **è‡ªåŠ¨éƒ¨ç½²**: Gitæ¨é€å³éƒ¨ç½²
- **é¢„è§ˆéƒ¨ç½²**: æ¯ä¸ªPRéƒ½æœ‰é¢„è§ˆé“¾æ¥
- **è¾¹ç¼˜å‡½æ•°**: æ”¯æŒAPIè·¯ç”±

### éƒ¨ç½²æ­¥éª¤

#### æ–¹æ³•ä¸€ï¼šWebç•Œé¢éƒ¨ç½²
1. è®¿é—® [vercel.com](https://vercel.com)
2. ä½¿ç”¨GitHubè´¦å·ç™»å½•
3. ç‚¹å‡» "New Project"
4. é€‰æ‹©ä½ çš„ä»“åº“
5. ç‚¹å‡» "Deploy"

#### æ–¹æ³•äºŒï¼šå‘½ä»¤è¡Œéƒ¨ç½²
```bash
# å®‰è£…Vercel CLI
npm i -g vercel

# ç™»å½•
vercel login

# éƒ¨ç½²
vercel --prod
```

### ç¯å¢ƒå˜é‡é…ç½®
åœ¨Vercelæ§åˆ¶å°è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```
NEXT_PUBLIC_API_URL=https://your-api.com
NEXT_PUBLIC_SITE_NAME=ä¼ä¸šé—¨æˆ·ç½‘ç«™
```

### è‡ªå®šä¹‰åŸŸå
1. åœ¨Vercelé¡¹ç›®è®¾ç½®ä¸­æ·»åŠ åŸŸå
2. é…ç½®DNSè®°å½•ï¼š
   - ç±»å‹ï¼šCNAME
   - åç§°ï¼šwww
   - å€¼ï¼šcname.vercel-dns.com

### æ€§èƒ½ä¼˜åŒ–
```javascript
// vercel.json
{
  "functions": {
    "app/api/**/*.js": {
      "maxDuration": 30
    }
  },
  "headers": [
    {
      "source": "/api/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "s-maxage=60"
        }
      ]
    }
  ]
}
```

## 2. ğŸ¯ Netlify éƒ¨ç½²

### ç‰¹ç‚¹
- **ç®€å•æ˜“ç”¨**: æ‹–æ‹½å³å¯éƒ¨ç½²
- **è¡¨å•å¤„ç†**: å†…ç½®è¡¨å•åŠŸèƒ½
- **å‡½æ•°æ”¯æŒ**: Serverlesså‡½æ•°
- **åˆ†æ”¯éƒ¨ç½²**: å¤šç¯å¢ƒæ”¯æŒ

### éƒ¨ç½²æ­¥éª¤

#### æ–¹æ³•ä¸€ï¼šæ‹–æ‹½éƒ¨ç½²
1. è¿è¡Œ `npm run build`
2. å°† `out/` æ–‡ä»¶å¤¹æ‹–æ‹½åˆ° Netlify
3. è‡ªåŠ¨éƒ¨ç½²å®Œæˆ

#### æ–¹æ³•äºŒï¼šGité›†æˆ
1. è¿æ¥GitHubä»“åº“
2. é…ç½®æ„å»ºè®¾ç½®ï¼š
   - æ„å»ºå‘½ä»¤ï¼š`npm run build`
   - å‘å¸ƒç›®å½•ï¼š`out`
3. è‡ªåŠ¨éƒ¨ç½²

### é…ç½®æ–‡ä»¶
```toml
# netlify.toml
[build]
  command = "npm run build"
  publish = "out"

[[headers]]
  for = "/*"
  [headers.values]
    X-Frame-Options = "DENY"
    X-XSS-Protection = "1; mode=block"
    X-Content-Type-Options = "nosniff"

[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/:splat"
  status = 200
```

### è¡¨å•å¤„ç†
```html
<!-- è”ç³»è¡¨å• -->
<form name="contact" method="POST" data-netlify="true">
  <input type="hidden" name="form-name" value="contact" />
  <input type="text" name="name" placeholder="å§“å" />
  <input type="email" name="email" placeholder="é‚®ç®±" />
  <textarea name="message" placeholder="ç•™è¨€"></textarea>
  <button type="submit">æäº¤</button>
</form>
```

## 3. ğŸ“¦ é™æ€å¯¼å‡ºéƒ¨ç½²

### é€‚ç”¨åœºæ™¯
- ä¼ ç»ŸæœåŠ¡å™¨
- CDNéƒ¨ç½²
- å¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰
- GitHub Pages

### é…ç½®é™æ€å¯¼å‡º
```javascript
// next.config.js
/** @type {import('next').NextConfig} */
const nextConfig = {
  output: 'export',
  trailingSlash: true,
  images: {
    unoptimized: true
  },
  assetPrefix: process.env.NODE_ENV === 'production' ? '/your-repo-name' : ''
}

module.exports = nextConfig
```

### æ„å»ºå‘½ä»¤
```bash
# æ„å»ºé™æ€æ–‡ä»¶
npm run build

# ç”Ÿæˆçš„æ–‡ä»¶åœ¨ out/ ç›®å½•
ls out/
# index.html  about.html  _next/  assets/
```

### éƒ¨ç½²åˆ°ä¸åŒå¹³å°

#### GitHub Pages
```yaml
# .github/workflows/deploy.yml
name: Deploy to GitHub Pages

on:
  push:
    branches: [ main ]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Build
        run: npm run build
        
      - name: Deploy
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./out
```

#### é˜¿é‡Œäº‘OSS
```bash
# å®‰è£…ossutil
wget http://gosspublic.alicdn.com/ossutil/1.7.0/ossutil64
chmod 755 ossutil64

# é…ç½®OSS
./ossutil64 config

# ä¸Šä¼ æ–‡ä»¶
./ossutil64 cp -r out/ oss://your-bucket/
```

#### è…¾è®¯äº‘COS
```bash
# å®‰è£…coscmd
pip install coscmd

# é…ç½®COS
coscmd config -a SecretId -s SecretKey -b BucketName -r Region

# ä¸Šä¼ æ–‡ä»¶
coscmd upload -r out/ /
```

## 4. ğŸ³ Docker éƒ¨ç½²

### ç‰¹ç‚¹
- **ç¯å¢ƒä¸€è‡´**: å¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒä¸€è‡´
- **æ˜“äºæ‰©å±•**: æ”¯æŒæ°´å¹³æ‰©å±•
- **ç‰ˆæœ¬æ§åˆ¶**: é•œåƒç‰ˆæœ¬ç®¡ç†
- **éš”ç¦»æ€§**: åº”ç”¨éš”ç¦»

### Dockerfile
```dockerfile
# å¤šé˜¶æ®µæ„å»º
FROM node:18-alpine AS builder

WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npm run build

# ç”Ÿäº§é•œåƒ
FROM node:18-alpine AS runner

WORKDIR /app

# åˆ›å»ºérootç”¨æˆ·
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/public ./public
COPY --from=builder /app/.next/standalone ./
COPY --from=builder /app/.next/static ./.next/static

# è®¾ç½®æƒé™
USER nextjs

EXPOSE 3000

ENV PORT 3000
ENV HOSTNAME "0.0.0.0"

CMD ["node", "server.js"]
```

### docker-compose.yml
```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - NEXT_PUBLIC_API_URL=https://api.example.com
    restart: unless-stopped
    
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - web
    restart: unless-stopped
```

### æ„å»ºå’Œè¿è¡Œ
```bash
# æ„å»ºé•œåƒ
docker build -t cms-app .

# è¿è¡Œå®¹å™¨
docker run -p 3000:3000 cms-app

# ä½¿ç”¨docker-compose
docker-compose up -d
```

## 5. ğŸ–¥ï¸ äº‘æœåŠ¡å™¨éƒ¨ç½²

### æœåŠ¡å™¨è¦æ±‚
- **CPU**: 2æ ¸ä»¥ä¸Š
- **å†…å­˜**: 4GBä»¥ä¸Š
- **å­˜å‚¨**: 20GBä»¥ä¸Š
- **å¸¦å®½**: 5Mbpsä»¥ä¸Š

### éƒ¨ç½²æ­¥éª¤

#### 1. ç¯å¢ƒå‡†å¤‡
```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs

# å®‰è£…PM2
sudo npm install -g pm2

# å®‰è£…Nginx
sudo apt install nginx -y
```

#### 2. ä»£ç éƒ¨ç½²
```bash
# å…‹éš†ä»£ç 
git clone https://github.com/your-username/cms.git
cd cms

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# å¯åŠ¨åº”ç”¨
pm2 start npm --name "cms" -- start
pm2 save
pm2 startup
```

#### 3. Nginxé…ç½®
```nginx
# /etc/nginx/sites-available/cms
server {
    listen 80;
    server_name your-domain.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # é™æ€æ–‡ä»¶ç¼“å­˜
    location /_next/static {
        alias /path/to/cms/.next/static;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
```

#### 4. SSLè¯ä¹¦é…ç½®
```bash
# å®‰è£…Certbot
sudo apt install certbot python3-certbot-nginx -y

# è·å–SSLè¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ï¼š0 12 * * * /usr/bin/certbot renew --quiet
```

#### 5. ç›‘æ§å’Œæ—¥å¿—
```bash
# æŸ¥çœ‹åº”ç”¨çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs cms

# ç›‘æ§èµ„æºä½¿ç”¨
pm2 monit

# é‡å¯åº”ç”¨
pm2 restart cms
```

## 6. ğŸ”„ CI/CD è‡ªåŠ¨åŒ–éƒ¨ç½²

### GitHub Actions
```yaml
# .github/workflows/deploy.yml
name: Deploy to Production

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run tests
        run: npm test
        
      - name: Build
        run: npm run build
        
      - name: Deploy to server
        uses: appleboy/ssh-action@v0.1.5
        with:
          host: ${{ secrets.HOST }}
          username: ${{ secrets.USERNAME }}
          key: ${{ secrets.KEY }}
          script: |
            cd /var/www/cms
            git pull origin main
            npm install
            npm run build
            pm2 restart cms
```

## 7. ğŸ” éƒ¨ç½²åæ£€æŸ¥

### æ€§èƒ½æ£€æŸ¥
```bash
# ä½¿ç”¨Lighthouseæ£€æŸ¥
npx lighthouse https://your-domain.com --output html

# ä½¿ç”¨PageSpeed Insights
# https://pagespeed.web.dev/
```

### ç›‘æ§è®¾ç½®
```javascript
// lib/analytics.js
export function trackPageView(url) {
  if (typeof window !== 'undefined' && window.gtag) {
    window.gtag('config', 'GA_TRACKING_ID', {
      page_path: url,
    })
  }
}
```

### é”™è¯¯ç›‘æ§
```javascript
// lib/sentry.js
import * as Sentry from '@sentry/nextjs'

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
})
```

## 8. ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å›¾ç‰‡ä¼˜åŒ–
```javascript
// next.config.js
module.exports = {
  images: {
    domains: ['your-domain.com'],
    formats: ['image/webp', 'image/avif'],
  },
}
```

### 2. ç¼“å­˜ç­–ç•¥
```javascript
// next.config.js
module.exports = {
  async headers() {
    return [
      {
        source: '/(.*)',
        headers: [
          {
            key: 'Cache-Control',
            value: 'public, max-age=3600, stale-while-revalidate=86400',
          },
        ],
      },
    ]
  },
}
```

### 3. å‹ç¼©é…ç½®
```javascript
// next.config.js
module.exports = {
  compress: true,
  poweredByHeader: false,
  generateEtags: false,
}
```

## 9. ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### Q1: éƒ¨ç½²åé¡µé¢ç©ºç™½
**è§£å†³æ–¹æ¡ˆ**:
```javascript
// next.config.js
module.exports = {
  assetPrefix: process.env.NODE_ENV === 'production' ? '/your-path' : '',
}
```

### Q2: é™æ€èµ„æº404
**è§£å†³æ–¹æ¡ˆ**:
```javascript
// next.config.js
module.exports = {
  basePath: '/your-base-path',
}
```

### Q3: ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆ
**è§£å†³æ–¹æ¡ˆ**:
```bash
# ç¡®ä¿ç¯å¢ƒå˜é‡ä»¥NEXT_PUBLIC_å¼€å¤´
NEXT_PUBLIC_API_URL=https://api.example.com
```

---

é€‰æ‹©é€‚åˆä½ çš„éƒ¨ç½²æ–¹æ¡ˆï¼Œå¼€å§‹æ„å»ºä½ çš„ä¼ä¸šé—¨æˆ·ç½‘ç«™å§ï¼